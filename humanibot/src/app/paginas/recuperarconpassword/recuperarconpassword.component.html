<div class="min-h-screen flex flex-col bg-background text-foreground transition-colors">
  <!-- Header Section -->
  <header class=" bg-card/50 backdrop-blur-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12">
      <div class="flex justify-between items-center py-6">
        <!-- Logo + Nombre -->
        <div class="flex items-center space-x-4">
          <div class="w-14 h-14 bg-primary rounded-2xl flex items-center justify-center shadow-lg">
            <a class="flex items-center" href="/">
              <ng-container *ngIf="darkTheme(); else lightLogo">
                <img src="img/negro.png" alt="humanibot" class="w-12" />
              </ng-container>
              <ng-template #lightLogo>
                <img src="img/blanco.png" alt="humanibot" class="w-10" />
              </ng-template>
            </a>
          </div>
          <a href="/" class="text-3xl font-extrabold tracking-tight text-primary titulo">HumaniBot</a>
        </div>

        <!-- Actions -->
        <div class="layout-config-menu flex gap-6">
          <!-- Dark/Light Mode -->
          <button type="button" class="layout-topbar-action text-3xl hover:text-primary transition-colors"
            (click)="toggleDarkMode()">
            <i style="font-size: 20px;"
              [ngClass]="{ 'pi': true, 'pi-moon': layoutService.isDarkTheme(), 'pi-sun': !layoutService.isDarkTheme() }"></i>
          </button>

          <!-- Configurator -->
          <div class="relative">
            <button
              class="layout-topbar-action layout-topbar-action-highlight text-3xl hover:text-primary transition-colors"
              pStyleClass="@next" enterFromClass="hidden" enterActiveClass="animate-scalein" leaveToClass="hidden"
              leaveActiveClass="animate-fadeout" [hideOnOutsideClick]="true">
              <i style="font-size: 20px;" class="pi pi-palette"></i>
            </button>
            <app-configurator />
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8 py-16">
    <div class="max-w-md w-full space-y-8">
      <!-- Title Section -->
      <div class="text-center">
        <div
          class="mx-auto w-20 h-20 bg-primary/10 dark:bg-primary/20 rounded-full flex items-center justify-center mb-6 shadow-inner">
          <svg class="w-10 h-10 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
          </svg>
        </div>
        <h1 class="text-3xl font-bold tracking-tight">Recuperar Contrase√±a</h1>
        <p class="mt-3 text-muted-foreground leading-relaxed">
          @if (mostrarSegundoFormulario) {
          <span>Ingresa el c√≥digo de verificaci√≥n que te hemos enviado por correo electr√≥nico.</span>
          }@else {
            <span>Ingresa tu correo electr√≥nico y te enviaremos un c√≥digo de verificaci√≥n para restablecer tu contrase√±a.</span>
          }
        </p>
      </div>

      <!-- Form Section -->
      @if (mostrarSegundoFormulario) {
      <div class="bg-card rounded-2xl border border-border p-8 shadow-xl transition-colors max-w-md mx-auto">
        <form [formGroup]="resetForm2" (ngSubmit)="restablecerPassword()" class="space-y-6">

          <!-- C√≥digo -->
          <div>
            <label for="codigo" class="block text-sm font-medium mb-2">Introduce el c√≥digo</label>
            <input id="codigo" type="text" formControlName="codigo" class="block w-full pl-3 pr-3 py-3 border border-border rounded-lg bg-input text-foreground
        placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary
        focus:border-transparent transition-colors" placeholder="Ingresa el c√≥digo" />

            <p *ngIf="codigo?.invalid && (codigo?.touched || codigo?.dirty)" class="text-red-500 text-sm mt-1">
              ‚ö† Solo n√∫meros son permitidos
            </p>
          </div>

          <!-- Nueva contrase√±a -->
          <div>
            <label for="password" class="block text-sm font-medium mb-2">Nueva contrase√±a</label>
            <div class="relative">
              <input id="password" [type]="showPassword ? 'text' : 'password'" formControlName="password" class="block w-full pl-3 pr-10 py-3 border border-border rounded-lg bg-input text-foreground
          placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary
          focus:border-transparent transition-colors" placeholder="Nueva contrase√±a" />

              <!-- Ojito -->
              <button type="button" (click)="showPassword = !showPassword"
                class="absolute inset-y-0 right-3 flex items-center text-slate-500">
                <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.338-4.044M9.88 9.88a3 3 0 104.24 4.24" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />
                </svg>
              </button>
            </div>
            <p *ngIf="password?.invalid && (password?.touched || password?.dirty)" class="text-red-500 text-sm mt-1">
              ‚ö† La contrase√±a debe tener al menos 6 caracteres
            </p>
          </div>

          <!-- Confirmar contrase√±a -->
          <div>
            <label for="confirmPassword" class="block text-sm font-medium mb-2">Confirma tu contrase√±a</label>
            <div class="relative">
              <input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword" class="block w-full pl-3 pr-10 py-3 border border-border rounded-lg bg-input text-foreground
          placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary
          focus:border-transparent transition-colors" placeholder="Confirma tu contrase√±a" />

              <!-- Ojito -->
              <button type="button" (click)="showConfirmPassword = !showConfirmPassword"
                class="absolute inset-y-0 right-3 flex items-center text-slate-500">
                <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.338-4.044M9.88 9.88a3 3 0 104.24 4.24" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />
                </svg>
              </button>
            </div>

            <!-- Error si las contrase√±as no coinciden -->
            <p *ngIf="resetForm2.errors?.['passwordMismatch'] && confirmPassword?.touched"
              class="text-red-500 text-sm mt-1">
              ‚ö† Las contrase√±as no coinciden
            </p>
          </div>

          <!-- Bot√≥n -->
          <button type="submit" [disabled]="resetForm2.invalid || isLoading"
            class="w-full disabled:opacity-50 disabled:cursor-not-allowed text-white flex justify-center items-center py-3 px-4 rounded-lg shadow-md text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 dark:text-black focus:ring-offset-2 focus:ring-primary transition-all">

            <ng-container *ngIf="!isLoading; else loadingTpl">
              Restablecer Contrase√±a
            </ng-container>
            <ng-template #loadingTpl>
              <svg class="animate-spin h-5 w-5 text-white dark:text-black" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
              Procesando...
            </ng-template>
          </button>
        </form>
      </div>



      }
      @else {
      <div class="bg-card rounded-2xl border border-border p-8 shadow-xl transition-colors">
        <form [formGroup]="resetForm" (ngSubmit)="enviarCodigoAlCorreo()" class="space-y-6">
          <div>
            <label for="email" class="block text-sm font-medium mb-2">
              Correo Electr√≥nico
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
                </svg>
              </div>
              <input id="email" type="email" formControlName="email" autocomplete="email"
                placeholder="tu_correo_@gmail.com"
                class="block w-full pl-10 pr-3 py-3 border border-border rounded-lg bg-input text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors" />
            </div>

            <!-- Mensajes de error -->
            <div class="mt-2 text-sm text-red-500" *ngIf="email?.touched && email?.invalid">
              <span *ngIf="email?.errors?.['required']">El correo es obligatorio</span>
              <span *ngIf="email?.errors?.['email']">Formato de correo no v√°lido</span>
            </div>
          </div>

          <button type="submit" [disabled]="resetForm.invalid"
            class="w-full disabled:opacity-50 disabled:cursor-not-allowed text-white flex justify-center items-center py-3 px-4 rounded-lg shadow-md text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 dark:text-black focus:ring-offset-2 focus:ring-primary transition-all">

            @if (isLoading) {
            <svg class="animate-spin h-5 w-5 text-white dark:text-black" xmlns="http://www.w3.org/2000/svg" fill="none"
              viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            Procesando...
            } @else {

            Enviar c√≥digo de verificaci√≥n
            }
          </button>
        </form>


        <!-- Back to Login Link -->
        <div class="mt-6 text-center">
          <a href="/" class="text-sm text-primary hover:underline">
            ‚Üê Volver al inicio
          </a>
        </div>
      </div>
      }

      <!-- Trust Elements -->
      <div class="text-center space-y-4">
        <div class="flex justify-center items-center space-x-6">
          <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-accent rounded-full flex items-center justify-center">
              <i class="pi pi-shield text-accent-foreground text-xs"></i>
            </div>
            <span class="text-xs text-muted-foreground">SSL Seguro</span>
          </div>
          <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-accent rounded-full flex items-center justify-center">
              <i class="pi pi-lock text-accent-foreground text-xs"></i>
            </div>
            <span class="text-xs text-muted-foreground">Privacidad</span>
          </div>
        </div>
        <p class="text-xs text-muted-foreground max-w-sm mx-auto leading-relaxed">
          Tu informaci√≥n est√° protegida con encriptaci√≥n avanzada. No compartimos tus datos con terceros.
        </p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class=" bg-card/50 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0">
        <p class="text-xs text-muted-foreground text-center sm:text-left">
          üîê Protege tu cuenta, üîÑ transforma tu seguridad, üåü conf√≠a en un futuro m√°s seguro.
        </p>
        <div class="flex space-x-6">
          <!-- <a href="#" class="text-xs text-secondary-foreground hover:text-primary transition-colors">
          T√©rminos de Servicio
        </a>
        <a href="#" class="text-xs text-secondary-foreground hover:text-primary transition-colors">
          Pol√≠tica de Privacidad
        </a>
        <a href="#" class="text-xs text-secondary-foreground hover:text-primary transition-colors">
          Soporte
        </a> -->
        </div>
      </div>
    </div>
  </footer>

</div>


<div *ngIf="abrirModaldeExitoCorreo" class="fixed inset-0 z-50 flex items-center justify-center px-4 sm:px-6 lg:px-8"
  aria-modal="true" role="dialog">
  <div class="absolute inset-0 bg-black/40 backdrop-blur-sm dark:bg-black/60"></div>

  <div class="relative z-10 w-full max-w-md rounded-2xl shadow-2xl transform transition-all duration-300
           bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100
           ring-1 ring-slate-200 dark:ring-slate-800
           p-6 sm:p-8 animate-[fadeInScale_0.3s_ease-out_forwards]">
    <div class="flex items-start space-x-4">
      <div
        class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center bg-green-100 dark:bg-green-900/30">
        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>

      <div class="flex-1 min-w-0">
        <h2 class="text-lg font-semibold">¬°√âxito!</h2>
        <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
          Hemos enviado un c√≥digo de verificaci√≥n al correo:
          <span class="block mt-1 font-medium text-slate-800 dark:text-slate-100 truncate">
            {{ correo }}
          </span>
        </p>

        <!-- Mensaje aclaratorio -->
        <p class="mt-4 text-sm text-slate-700 dark:text-slate-300">
          <strong>Importante:</strong> despu√©s de cerrar este mensaje, se abrir√° un
          formulario donde deber√°s ingresar el c√≥digo recibido y tu nueva contrase√±a.
        </p>

        <!-- Botones -->
        <div class="mt-6 flex gap-3">
          <button type="button" (click)="abrirModaldeExitoCorreo = false" class="flex-1 inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm font-medium
                   bg-green-600 text-white shadow hover:bg-green-700
                   focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500
                   transition-colors">
            Entendido
          </button>

          <button type="button" (click)="abrirGmail()" class="flex-1 inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm font-medium
             border border-slate-300 dark:border-slate-700
             bg-white dark:bg-slate-800 text-green-600 dark:text-green-400
             hover:bg-green-50 dark:hover:bg-slate-700
             focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500
             transition-colors">
            Abrir Gmail
          </button>
        </div>
      </div>
    </div>

    <p class="mt-6 text-xs text-center text-slate-500 dark:text-slate-400">
      Si no llega en unos minutos, revisa la carpeta de spam o solicita otro c√≥digo.
    </p>
  </div>
</div>



<!-- Modal Contrase√±a Cambiada -->
<div *ngIf="abrirModalPasswordCambiada" class="fixed inset-0 z-50 flex items-center justify-center px-4 sm:px-6 lg:px-8"
  aria-modal="true" role="dialog">

  <!-- Fondo oscuro -->
  <div class="absolute inset-0 bg-black/40 backdrop-blur-sm dark:bg-black/60"></div>

  <!-- Contenedor modal -->
  <div class="relative z-10 w-full max-w-md rounded-2xl shadow-2xl transform transition-all duration-300
           bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100
           ring-1 ring-slate-200 dark:ring-slate-800
           p-6 sm:p-8 animate-[fadeInScale_0.3s_ease-out_forwards]">

    <!-- Icono verde check -->
    <div class="flex flex-col items-center text-center">
      <div class="w-16 h-16 rounded-full flex items-center justify-center bg-green-100 dark:bg-green-900/30">
        <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>

      <h2 class="mt-4 text-xl font-semibold">¬°Contrase√±a cambiada!</h2>
      <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
        Tu contrase√±a ha sido actualizada correctamente.
        Ahora puedes iniciar sesi√≥n con tu nueva contrase√±a.
      </p>
    </div>

    <!-- Bot√≥n Volver al login -->
    <div class="mt-6 flex justify-center">
      <button type="button" (click)="volverAlLogin()" class="inline-flex items-center justify-center px-6 py-3 rounded-lg text-sm font-medium
               bg-primary text-white dark:text-black shadow hover:bg-primary/90
               focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary
               transition-colors">
        Volver al Login
      </button>
    </div>
  </div>
</div>